<% start_date = Date.today %>
<% end_date = start_date + 6.days %>

<% events_in_range = @events.select { |event| (event.start_time.to_date..(event.end_time || event.start_time).to_date).overlaps?(start_date..end_date) } %>
<div class="index_top">
<table>
  <thead>
    <tr>
      <th>タイトル</th>
      <th>日時</th>
    </tr>
  </thead>

  <tbody>
    <% events_in_range.each do |event| %>
      <tr>
        <td><%= event.title %></td>
        <td>
          <% if event.all_day? %>
            <%= event.start_time.strftime("%m/%d") %>
            <% if event.end_time && event.start_time.to_date != event.end_time.to_date %>
              <% if event.end_time >= event.start_time %>
                - <%= event.end_time.strftime("%m/%d") %>
              <% end %>
            <% end %>
          <% else %>
            <%= event.start_time.strftime("%m/%d") %>
            <% if event.end_time && event.start_time.to_date != event.end_time.to_date %>
              <% if event.end_time >= event.start_time %>
                - <%= event.end_time.strftime("%m/%d") %>
              <% end %>
            <% end %>
          <% end %>
        </td>
        <td>【 <%= link_to '詳細', event_path(event.id) %> 】</td>
        <td>【 <%= link_to '編集', edit_event_path(event.id) %> 】</td>
        <td>【 <%= link_to '削除', event_path(event.id), data: { turbo_method: :delete} %> 】</td>
      </tr>
    <% end %>
  </tbody>
</table>